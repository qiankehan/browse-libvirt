# Qemu(kvm) xml namespace
By default, you cannot set the runtime variables for qemu(or kvm) domain
manually. They are generated by libvirt. Qemu(kvm) xml namespace provide a way
to customize these variables, including **qemu command line arguments**, **qemu
environment variables**, and **qemu capabilities**.  
To enable **qemu xml namespace**, add attribute
`xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'`:
```xml
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
</domain>
```
For qemu with **kvm** acceleration, use kvm domain type:
```xml
<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
</domain>
```

## Customized qemu arguments
Customize qemu arguments are usually to help qemu debugging with libvirt, or
test qemu features that are not implemented in libvirt. The xml format is:
```xml
<domain type='kvm' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
  <qemu:commandline>
    <qemu:arg value='ARGV1'/>
    <qemu:arg value='ARGV2'/>
  </qemu:commandline>
</domain>
```
The *ARGV1 ARGV2* here represent the qemu command line arguments. For example,
to start a domain with tcp qmp, the xml will be like:
```
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
  <qemu:commandline>
    <qemu:arg value='-qmp'/>
    <qemu:arg value='tcp:localhost:4444,server,nowait'/>
  </qemu:commandline>
</domain>
```
That will be translated as qemu command line
`qemu [...] -qmp tcp:localhost:4444,server,nowait`.

## Customized qemu environment variables
This means the environment variables of qemu process when libvirt start a
domain. The format of it is:
```
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
  <qemu:commandline>
    <qemu:env name='NAME' value='VALUE'/>
  </qemu:commandline>
</domain>
```
Then libvirt can start the domain as `NAME=VALUE qemu ...` such command line.  
For example, start a domain with
[jemalloc memory leak check](https://github.com/jemalloc/jemalloc/wiki/Use-Case%3A-Leak-Checking)
to enable memory leak check:
```xml
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
...
  <qemu:commandline>
    <qemu:env name='LD_PRELOAD' value='/usr/lib64/libjemalloc.so'/>
    <qemu:env name='MALLOC_CONF' value='prof:true,prof_prefix:/tmp/qemu_jeprof'/>
  </qemu:commandline>
</domain>
```
Then after the qemu domain closed, the memory leak profiling file will be
dumped with prefix */tmp/qemu_jeprof*.


## Customized qemu capabilities
Libvirt use **capability** to mark a feature is enabled or disabled, defined in
[virQEMUCaps enum list](https://github.com/libvirt/libvirt/blob/b0ecc0a04cfcfc706e252d3960f7f10db45c9186/src/qemu/qemu_capabilities.c#L66)
. By default, the capabilities are determined by qemu or libvirt version. Since
**libvirt-5.5**, we provide a series of xml elements and attributes to enable
or disabled capabilities manually. The format of it is:
```xml
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  ...
  <qemu:capabilities>
    <qemu:add capability='CAP1'/>
    <qemu:del capability='CAP2'/>
  </qemu:capabilities>
</domain>
```
The *CAP1* is the capability to be enabled, *CAP2* to be disabled.  
Here is a example to replace **-drive** to **-blockdev** in domain command line:
```xml
<domain type='qemu' xmlns:qemu='http://libvirt.org/schemas/domain/qemu/1.0'>
  ...
  <qemu:capabilities>
    <qemu:add capability='blockdev'/>
    <qemu:del capability='drive'/>
  </qemu:capabilities>
</domain>
```
